<!doctype html>
<html lang="no">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Imposter ‚Äî spill</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>html, body, #root { height: 100%; }</style>
</head>
<body class="antialiased">
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useEffect } = React;
    const WORDS = { dyr: ['Elefant', 'Pingvin', 'Delfin', 'Tiger', 'Kenguru', 'Bj√∏rn', 'Rev', 'Ugle', 'Hai', 'Papeg√∏ye', 'Zebra', 'Giraff', 'Panda', 'Koala', 'Leopard'], ting: ['Piano', 'Paraply', 'Kompass', 'Teleskop', 'Koffert', 'Lommelykt', 'Mikrofon', 'Kamera', 'Sykkel', 'Skateboard', 'Trampoline', 'Fyrstikk', 'Hammer', 'Ferdigrett'] };
    function storageGet(key) { try { return localStorage.getItem(key); } catch { return null; } }
    function storageSet(key, value) { try { localStorage.setItem(key, value); } catch {} }
    function generateCode() { return Math.random().toString(36).substring(2, 8).toUpperCase(); }
    function ImposterGame() {
      const [gameState, setGameState] = useState(null);
      const [playerName, setPlayerName] = useState('');
      const [roomCode, setRoomCode] = useState('');
      const [roomInput, setRoomInput] = useState('');
      const [currentPlayer, setCurrentPlayer] = useState(null);
      const [voted, setVoted] = useState(false);
      const [loading, setLoading] = useState(false);
      const [error, setError] = useState('');
      useEffect(() => { if (roomCode) { loadGameState(); const i=setInterval(loadGameState,2000); return ()=>clearInterval(i);} }, [roomCode]);
      const loadGameState=()=>{try{const raw=storageGet('game:'+roomCode);if(raw)setGameState(JSON.parse(raw));}catch{}};
      const saveGameState=(s)=>{if(!roomCode)return;storageSet('game:'+roomCode,JSON.stringify(s));setGameState(s);};
      const createRoom=()=>{if(!playerName.trim()){setError('Skriv inn navnet ditt!');return;}setError('');const code=generateCode();const id=Math.random().toString(36).substring(7);const g={phase:'lobby',players:[{id,name:playerName,score:0}],word:null,imposter:null,votes:{},category:'dyr'};storageSet('game:'+code,JSON.stringify(g));setRoomCode(code);setCurrentPlayer({id,name:playerName});setGameState(g);};
      const joinRoom=()=>{if(!playerName.trim()){setError('Skriv inn navnet ditt!');return;}if(!roomInput.trim()){setError('Skriv inn rom-kode!');return;}setError('');setLoading(true);const code=roomInput.toUpperCase();const raw=storageGet('game:'+code);if(!raw){setError('Rom ikke funnet');setLoading(false);return;}const g=JSON.parse(raw);if(g.players.find(p=>p.name===playerName)){setError('Navnet er tatt');setLoading(false);return;}const id=Math.random().toString(36).substring(7);g.players.push({id,name:playerName,score:0});storageSet('game:'+code,JSON.stringify(g));setRoomCode(code);setCurrentPlayer({id,name:playerName});setGameState(g);setLoading(false);};
      const startGame=()=>{if(gameState.players.length<3){setError('Trenger minst 3 spillere!');return;}setError('');const cat=Math.random()>0.5?'dyr':'ting';const word=WORDS[cat][Math.floor(Math.random()*WORDS[cat].length)];const imp=gameState.players[Math.floor(Math.random()*gameState.players.length)].id;const n={...gameState,phase:'showWord',word,imposter:imp,category:cat,votes:{}};saveGameState(n);setTimeout(()=>saveGameState({...n,phase:'discussion'}),8000);};
      const startVoting=()=>saveGameState({...gameState,phase:'voting',votes:{}});
      const castVote=(vid)=>{if(voted)return;const v={...gameState.votes,[currentPlayer.id]:vid};saveGameState({...gameState,votes:v});setVoted(true);if(Object.keys(v).length===gameState.players.length)setTimeout(()=>showResults(v),1000);};
      const showResults=(v)=>{const c={};Object.values(v).forEach(id=>c[id]=(c[id]||0)+1);let m=0,s=null;Object.entries(c).forEach(([id,n])=>{if(n>m){m=n;s=id;}});const ps=gameState.players.map(p=>{if(s===gameState.imposter&&p.id!==gameState.imposter)return{...p,score:p.score+1};if(s!==gameState.imposter&&p.id===gameState.imposter)return{...p,score:p.score+2};return p;});saveGameState({...gameState,phase:'results',players:ps,suspectId:s});};
      const playAgain=()=>saveGameState({...gameState,phase:'lobby',word:null,imposter:null,votes:{},suspectId:null});
      if(!roomCode)return <div className="flex h-screen items-center justify-center bg-gradient-to-br from-purple-500 via-pink-500 to-orange-400"><div className="bg-white p-6 rounded-xl shadow-xl max-w-md w-full"><h1 className="text-3xl font-bold text-center mb-2">IMPOSTER</h1><p className="text-center text-gray-500 mb-6">Hvem lyver om ordet?</p><input className="w-full border rounded p-3 mb-3" placeholder="Ditt navn" value={playerName} onChange={e=>setPlayerName(e.target.value)} /><button className="w-full bg-purple-500 text-white p-3 rounded mb-3" onClick={createRoom}>Lag nytt rom</button><input className="w-full border rounded p-3 mb-3" placeholder="Rom-kode" value={roomInput} onChange={e=>setRoomInput(e.target.value.toUpperCase())}/><button className="w-full bg-orange-500 text-white p-3 rounded" onClick={joinRoom}>Bli med i rom</button>{error&&<p className="text-red-600 text-center mt-3">{error}</p>}</div></div>;
      if(!gameState)return <div>Laster...</div>;
      const isImp=currentPlayer&&gameState.imposter===currentPlayer.id;
      return <div className="min-h-screen bg-gradient-to-br from-purple-500 via-pink-500 to-orange-400 p-4"><div className="bg-white rounded-2xl p-6 shadow-2xl max-w-2xl mx-auto">{gameState.phase==='lobby'&&<div><h2 className="text-2xl font-bold mb-4">Spillere</h2><ul className="mb-4">{gameState.players.map(p=><li key={p.id}>{p.name} ({p.score})</li>)}</ul><button onClick={startGame} className="bg-green-500 text-white px-4 py-2 rounded">Start</button></div>}{gameState.phase==='showWord'&&<div className="text-center">{isImp?<p>Du er imposteren! üïµÔ∏è</p>:<p>Ordet: {gameState.word}</p>}</div>}{gameState.phase==='discussion'&&<div className="text-center"><p>Diskuter n√•!</p><button onClick={()=>saveGameState({...gameState,phase:'voting'})} className="bg-blue-500 text-white px-4 py-2 rounded">Start avstemning</button></div>}{gameState.phase==='voting'&&<div><h2>Stem!</h2>{gameState.players.map(p=><button key={p.id} onClick={()=>castVote(p.id)} className="block w-full bg-purple-300 rounded p-2 my-1">{p.name}</button>)}</div>}{gameState.phase==='results'&&<div className="text-center"><h2>Resultater</h2><p>Ordet var: {gameState.word}</p><button onClick={playAgain} className="bg-green-500 text-white px-4 py-2 rounded">Spill igjen</button></div>}</div></div>;
    }
    ReactDOM.createRoot(document.getElementById('root')).render(<ImposterGame/>);
  </script>
</body>
</html>